<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="onecore_maintenance_extension.ModelSearch">
        <div t-ref="dropdown" class="model-search position-relative">
            <!-- Main input with clear button -->
            <div class="input-group">
                <input
                    t-ref="input"
                    type="text"
                    class="form-control"
                    t-att-value="state.searchText || currentValue"
                    t-att-placeholder="placeholder"
                    t-on-focus="onInputFocus"
                    t-on-input="onInputChange"
                    t-on-keydown="onInputKeydown"
                    t-on-blur="onInputBlur"
                    autocomplete="off"
                />
                <button
                    t-if="state.isLoading"
                    type="button"
                    class="btn btn-outline-secondary"
                    disabled="true"
                >
                    <i class="fa fa-spinner fa-spin"/>
                </button>
                <button
                    t-elif="currentValue"
                    type="button"
                    class="btn btn-outline-secondary"
                    t-on-click="onClearClick"
                    title="Rensa"
                >
                    <i class="fa fa-times"/>
                </button>
            </div>

            <!-- Dropdown menu -->
            <div
                t-if="state.isOpen and state.options.length > 0"
                class="dropdown-menu show w-100"
                style="max-height: 250px; overflow-y: auto;"
            >
                <t t-foreach="state.options" t-as="option" t-key="option.modelName">
                    <a
                        href="#"
                        t-attf-class="dropdown-item {{ option_index === state.highlightedIndex ? 'active' : '' }}"
                        t-on-click.prevent="() => this.selectOption(option)"
                        t-on-mouseenter="() => this.state.highlightedIndex = option_index"
                    >
                        <div class="fw-bold"><t t-esc="option.modelName"/></div>
                        <small class="text-muted"><t t-esc="option.manufacturer || 'Okänd tillverkare'"/></small>
                    </a>
                </t>
            </div>

            <!-- No results message -->
            <div
                t-if="state.isOpen and state.options.length === 0 and !state.isLoading and state.searchText.length >= 2"
                class="dropdown-menu show w-100"
            >
                <div class="dropdown-item text-muted">
                    Inga modeller hittades. Tryck Enter för att använda manuellt värde.
                </div>
            </div>

            <!-- Loading state -->
            <div
                t-if="state.isOpen and state.isLoading"
                class="dropdown-menu show w-100"
            >
                <div class="dropdown-item text-muted">
                    <i class="fa fa-spinner fa-spin me-2"/> Söker...
                </div>
            </div>
        </div>
    </t>

</templates>
