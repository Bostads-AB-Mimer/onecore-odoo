<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="onecore_maintenance_extension.JsonDropdown">
        <div t-ref="dropdown" class="json-dropdown position-relative">
            <!-- Main input with dropdown trigger -->
            <div class="input-group">
                <input
                    t-ref="input"
                    type="text"
                    class="form-control"
                    t-att-value="state.isOpen ? state.searchText : currentValue"
                    t-att-placeholder="currentValue || placeholder"
                    t-on-focus="onInputFocus"
                    t-on-input="onInputChange"
                    t-on-keydown="onInputKeydown"
                    autocomplete="off"
                />
                <button
                    type="button"
                    class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split"
                    t-on-click="toggleDropdown"
                >
                    <span class="visually-hidden">Toggle Dropdown</span>
                </button>
                <button
                    t-if="currentValue"
                    type="button"
                    class="btn btn-outline-secondary"
                    t-on-click="onClearClick"
                    title="Rensa"
                >
                    <i class="fa fa-times"/>
                </button>
            </div>

            <!-- Dropdown menu -->
            <div
                t-if="state.isOpen and state.options.length > 0"
                class="dropdown-menu show w-100"
                style="max-height: 250px; overflow-y: auto;"
            >
                <t t-foreach="filteredOptions" t-as="option" t-key="option.value">
                    <a
                        href="#"
                        t-attf-class="dropdown-item {{ option_index === state.highlightedIndex ? 'active' : '' }}"
                        t-on-click.prevent="() => this.selectOption(option)"
                        t-on-mouseenter="() => this.state.highlightedIndex = option_index"
                    >
                        <t t-esc="option.label"/>
                    </a>
                </t>
                <div t-if="filteredOptions.length === 0" class="dropdown-item text-muted">
                    Inga träffar
                </div>
            </div>

            <!-- Empty state -->
            <div
                t-if="state.isOpen and state.options.length === 0"
                class="dropdown-menu show w-100"
            >
                <div class="dropdown-item text-muted">
                    Inga alternativ tillgängliga
                </div>
            </div>
        </div>
    </t>

</templates>
